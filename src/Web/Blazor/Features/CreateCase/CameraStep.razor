@using Commentor.GivEtPraj.Blazor.Components
@using Commentor.GivEtPraj.Blazor.Services
@using Commentor.GivEtPraj.WebApi.Contracts.Requests
@inherits Step

<div class="w-[calc(100vw-2rem)] transition-all flex flex-col mr-8 h-full @Offset">
    @if (_viewGalleryModal)
    {
        <ImageGalleryModal CssClass="z-50 bg-red-500 absolute -my-2 -mx-4 w-screen h-screen opacity-90"></ImageGalleryModal>
    }
    <div class="z-0 absolute w-screen h-screen bg-black inset-0 -my-2 -mx-4 pointer-events-none"></div>
    <video class="z-10 absolute -mx-4 w-screen top-1/2 transform -translate-y-1/2" id="video" autoplay></video>

    <div class="flex flex-col justify-between h-[calc(100vh-1rem)] z-10">
        <Header CssClass="z-10 text-white" Title="Billeder" Icon="fas fa-chevron-left" OnBackClicked="Parent.PreviousPage"></Header>

        <div class="flex flex-row justify-between mx-8 mb-10 items-center">
            <button class="rounded-full z-10" type="button" @onclick="FlipCamera">
                <i class="text-white fal fa-sync text-4xl"></i>
            </button>
            <button class="bg-white-500 rounded-full w-16 h-16 border-4 border-white z-10" type="button" id="click-photo" @onclick="TakePhoto"></button>
            <button class="rounded-full w-14 h-14 z-10 bg-black border-2 border-gray-200" type="button" id="flipCam-btn" @onclick="FlipCamera">
                @if (Model.Images.Count == 0)
                {
                    <i class="fas fa-file-image text-white text-2xl z-20"></i>
                }
                else
                {
                    <Base64Picture></Base64Picture>
                }
            </button>
        </div>
    </div>
</div>

@code {
    private bool _viewGalleryModal = true;
    [Parameter] public CreateCaseRequest Model { get; set; } = null!;
    [Inject] private ICameraService CameraService { get; set; }
    [Parameter] public EventCallback<string> OnElementAdded { get; set; }

    protected override async void OnInitialized()
    {
        await CameraService.GetCameraFeed();
    }

    private async Task TakePhoto()
    {
        await OnElementAdded.InvokeAsync(await CameraService.TakePhoto());
    }

    private async Task FlipCamera()
    {
        await CameraService.FlipCamera();
    }
}
